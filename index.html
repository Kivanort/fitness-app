<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FitGame - Фитнес Приложение с элементами геймификации</title>
    <meta name="description" content="Фитнес приложение с элементами геймификации. Каталог упражнений, конструктор тренировок, персонаж и система достижений.">
    <meta name="keywords" content="фитнес, тренировки, упражнения, геймификация, здоровье, спорт">
    <meta name="author" content="Участник олимпиады по программированию">
    
    <!-- Open Graph для соцсетей -->
    <meta property="og:title" content="FitGame - Фитнес Приложение">
    <meta property="og:description" content="Интерактивное фитнес-приложение с элементами игры">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://ваш-логин.gitlab.io/fitness-app">
    <meta property="og:image" content="/images/og-image.png">
    
    <!-- Иконки -->
    <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
    <link rel="manifest" href="/manifest.json">
    
    <!-- Font Awesome для иконок -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Montserrat:wght@600;700&display=swap" rel="stylesheet">
    
    <!-- Основные стили -->
    <link rel="stylesheet" href="/src/styles/main.css">
    <link rel="stylesheet" href="/src/styles/components.css">
    
    <!-- Скрипты для улучшения производительности -->
    <script>
        // Предзагрузка критических ресурсов
        const preloadLinks = [
            '/src/main.jsx',
            'https://fonts.googleapis.com',
            'https://fonts.gstatic.com'
        ];
        
        // Добавляем класс no-js для плавного отображения
        document.documentElement.classList.remove('no-js');
        document.documentElement.classList.add('js');
        
        // Сохраняем тему из localStorage
        (function() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);
        })();
    </script>
    
    <!-- Структурированные данные для SEO -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "FitGame - Фитнес Приложение",
        "description": "Интерактивное фитнес-приложение с элементами геймификации",
        "url": "https://ваш-логин.gitlab.io/fitness-app",
        "applicationCategory": "HealthApplication",
        "operatingSystem": "Web",
        "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "USD"
        },
        "author": {
            "@type": "Person",
            "name": "Участник олимпиады"
        }
    }
    </script>
    
    <!-- PWA мета-теги -->
    <meta name="theme-color" content="#4CAF50">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <!-- Аналитика (опционально) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-XXXXX-X"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-XXXXX-X');
    </script>
</head>
<body>
    <!-- Контейнер для приложения React -->
    <div id="root" role="main" aria-label="Основное содержимое FitGame приложения">
        <!-- Fallback контент пока загружается React -->
        <div class="app-loading">
            <div class="loading-spinner">
                <div class="spinner">
                    <i class="fas fa-dumbbell"></i>
                </div>
                <h1>FitGame</h1>
                <p>Загружаем ваше фитнес-приложение...</p>
                <noscript>
                    <div class="noscript-warning">
                        <h2>Внимание!</h2>
                        <p>Для работы приложения требуется включить JavaScript в вашем браузере.</p>
                    </div>
                </noscript>
            </div>
        </div>
    </div>
    
    <!-- Скрипты -->
    <script type="module" src="/src/main.jsx"></script>
    
    <!-- Полифиллы для старых браузеров -->
    <script>
        // Проверка поддержки современных возможностей
        if (!window.Promise) {
            document.write('<script src="https://cdn.jsdelivr.net/npm/promise-polyfill@8/dist/polyfill.min.js"><\/script>');
        }
        if (!window.fetch) {
            document.write('<script src="https://cdn.jsdelivr.net/npm/whatwg-fetch@3.6.2/dist/fetch.umd.min.js"><\/script>');
        }
    </script>
    
    <!-- Уведомление о доступности -->
    <div class="accessibility-notice" role="region" aria-label="Уведомление о доступности">
        <button class="skip-to-content" onclick="document.getElementById('root').focus()">
            Перейти к основному содержимому
        </button>
    </div>
    
    <!-- Фоновые элементы для улучшения UX -->
    <div class="background-elements" aria-hidden="true">
        <div class="bg-circle circle-1"></div>
        <div class="bg-circle circle-2"></div>
        <div class="bg-circle circle-3"></div>
    </div>
    
    <!-- Стили для загрузки -->
    <style>
        /* Стили для состояния загрузки */
        .app-loading {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #4CAF50 0%, #2E7D32 100%);
            color: white;
        }
        
        .loading-spinner {
            text-align: center;
            animation: fadeIn 0.5s ease;
        }
        
        .spinner {
            width: 80px;
            height: 80px;
            margin: 0 auto 20px;
            position: relative;
        }
        
        .spinner i {
            font-size: 48px;
            color: white;
            animation: bounce 1.5s infinite ease-in-out;
        }
        
        .app-loading h1 {
            font-family: 'Montserrat', sans-serif;
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 700;
        }
        
        .app-loading p {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .noscript-warning {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }
        
        .noscript-warning h2 {
            color: #FF9800;
            margin-bottom: 10px;
        }
        
        .noscript-warning p {
            color: white;
        }
        
        /* Анимации */
        @keyframes bounce {
            0%, 100% {
                transform: translateY(0) rotate(0deg);
            }
            50% {
                transform: translateY(-20px) rotate(10deg);
            }
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* Стили для уведомления о доступности */
        .accessibility-notice {
            position: absolute;
            top: -100px;
            left: 0;
            width: 100%;
            z-index: 10000;
        }
        
        .skip-to-content {
            position: absolute;
            top: 10px;
            left: 10px;
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            transform: translateY(-100px);
            transition: transform 0.3s;
        }
        
        .skip-to-content:focus {
            transform: translateY(0);
        }
        
        /* Фоновые элементы */
        .background-elements {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
            overflow: hidden;
        }
        
        .bg-circle {
            position: absolute;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(76, 175, 80, 0.1) 0%, rgba(76, 175, 80, 0) 70%);
        }
        
        .circle-1 {
            width: 300px;
            height: 300px;
            top: -100px;
            right: -100px;
            animation: float 20s infinite ease-in-out;
        }
        
        .circle-2 {
            width: 200px;
            height: 200px;
            bottom: -50px;
            left: -50px;
            background: radial-gradient(circle, rgba(33, 150, 243, 0.1) 0%, rgba(33, 150, 243, 0) 70%);
            animation: float 15s infinite ease-in-out reverse;
        }
        
        .circle-3 {
            width: 150px;
            height: 150px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: radial-gradient(circle, rgba(255, 152, 0, 0.1) 0%, rgba(255, 152, 0, 0) 70%);
            animation: float 25s infinite ease-in-out;
        }
        
        @keyframes float {
            0%, 100% {
                transform: translate(0, 0);
            }
            25% {
                transform: translate(20px, 20px);
            }
            50% {
                transform: translate(-20px, 20px);
            }
            75% {
                transform: translate(20px, -20px);
            }
        }
        
        /* Стили для режима высокой контрастности */
        @media (prefers-contrast: high) {
            :root {
                --primary-color: #006400;
                --primary-dark: #004d00;
                --text-color: #000;
                --bg-color: #fff;
            }
        }
        
        /* Стили для режима уменьшенного движения */
        @media (prefers-reduced-motion: reduce) {
            *,
            *::before,
            *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }
        
        /* Темная тема */
        @media (prefers-color-scheme: dark) {
            :root {
                --text-color: #f0f0f0;
                --bg-color: #121212;
                --card-bg: #1e1e1e;
                --border-color: #333;
            }
            
            .app-loading {
                background: linear-gradient(135deg, #2E7D32 0%, #1B5E20 100%);
            }
        }
        
        /* Печать */
        @media print {
            .no-print {
                display: none !important;
            }
        }
    </style>
    
    <!-- Инициализация PWA -->
    <script>
        // Регистрация Service Worker для PWA
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js').then(registration => {
                    console.log('ServiceWorker зарегистрирован: ', registration.scope);
                }).catch(error => {
                    console.log('Ошибка регистрации ServiceWorker: ', error);
                });
            });
        }
        
        // Обработка установки PWA
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            
            // Показать кнопку установки
            setTimeout(() => {
                showInstallPrompt();
            }, 3000);
        });
        
        function showInstallPrompt() {
            if (deferredPrompt) {
                const installButton = document.createElement('button');
                installButton.textContent = 'Установить приложение';
                installButton.className = 'install-button';
                installButton.style.cssText = `
                    position: fixed;
                    bottom: 20px;
                    right: 20px;
                    background: #4CAF50;
                    color: white;
                    border: none;
                    padding: 12px 24px;
                    border-radius: 25px;
                    font-weight: bold;
                    cursor: pointer;
                    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
                    z-index: 1000;
                    transition: all 0.3s;
                `;
                installButton.onmouseover = () => {
                    installButton.style.transform = 'translateY(-2px)';
                    installButton.style.boxShadow = '0 6px 16px rgba(0,0,0,0.3)';
                };
                installButton.onmouseout = () => {
                    installButton.style.transform = 'translateY(0)';
                    installButton.style.boxShadow = '0 4px 12px rgba(0,0,0,0.2)';
                };
                
                installButton.onclick = async () => {
                    installButton.style.display = 'none';
                    deferredPrompt.prompt();
                    const { outcome } = await deferredPrompt.userChoice;
                    console.log(`Пользователь ${outcome} установку`);
                    deferredPrompt = null;
                };
                
                document.body.appendChild(installButton);
                
                // Автоматически скрыть через 10 секунд
                setTimeout(() => {
                    if (installButton.parentNode) {
                        installButton.style.opacity = '0';
                        installButton.style.transform = 'translateY(20px)';
                        setTimeout(() => {
                            if (installButton.parentNode) {
                                installButton.parentNode.removeChild(installButton);
                            }
                        }, 300);
                    }
                }, 10000);
            }
        }
        
        // Определение типа устройства
        const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        const isTablet = /iPad|Android(?!.*Mobile)|Tablet/i.test(navigator.userAgent);
        
        if (isMobile || isTablet) {
            document.documentElement.classList.add('touch-device');
        } else {
            document.documentElement.classList.add('desktop-device');
        }
        
        // Сохранение предпочтений пользователя
        function saveUserPreference(key, value) {
            try {
                localStorage.setItem(`fitgame_${key}`, JSON.stringify(value));
            } catch (e) {
                console.error('Ошибка сохранения настроек:', e);
            }
        }
        
        function getUserPreference(key, defaultValue) {
            try {
                const value = localStorage.getItem(`fitgame_${key}`);
                return value ? JSON.parse(value) : defaultValue;
            } catch (e) {
                return defaultValue;
            }
        }
        
        // Инициализация настроек при загрузке
        window.addEventListener('DOMContentLoaded', () => {
            // Восстановление темы
            const savedTheme = getUserPreference('theme', 'light');
            document.documentElement.setAttribute('data-theme', savedTheme);
            
            // Восстановление громкости звуков
            const volume = getUserPreference('volume', 0.5);
            
            // Проверка поддержки Web Audio API
            if (window.AudioContext || window.webkitAudioContext) {
                window.fitgameAudioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
        });
        
        // Глобальные обработчики ошибок
        window.addEventListener('error', (event) => {
            console.error('Произошла ошибка:', event.error);
            // Можно отправить ошибку на сервер для анализа
        });
        
        // Обработчик offline/online статуса
        window.addEventListener('offline', () => {
            console.log('Приложение перешло в оффлайн режим');
            // Можно показать уведомление пользователю
            showNotification('Вы в оффлайн режиме. Изменения сохранятся локально.', 'info');
        });
        
        window.addEventListener('online', () => {
            console.log('Приложение вернулось в онлайн режим');
            showNotification('Соединение восстановлено!', 'success');
        });
        
        function showNotification(message, type = 'info') {
            // Создание уведомления (можно реализовать более сложную систему)
            const notification = document.createElement('div');
            notification.textContent = message;
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${type === 'success' ? '#4CAF50' : type === 'error' ? '#F44336' : '#2196F3'};
                color: white;
                padding: 12px 24px;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                z-index: 10000;
                animation: slideIn 0.3s ease;
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 3000);
            
            // Добавляем стили для анимации
            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideIn {
                    from {
                        transform: translateX(100%);
                        opacity: 0;
                    }
                    to {
                        transform: translateX(0);
                        opacity: 1;
                    }
                }
                @keyframes slideOut {
                    from {
                        transform: translateX(0);
                        opacity: 1;
                    }
                    to {
                        transform: translateX(100%);
                        opacity: 0;
                    }
                }
            `;
            document.head.appendChild(style);
        }
        
        // Экспорт глобальных функций для отладки
        window.fitgame = {
            version: '1.0.0',
            savePreference: saveUserPreference,
            getPreference: getUserPreference,
            showNotification: showNotification,
            isMobile: isMobile,
            isTablet: isTablet
        };
    </script>
</body>
</html>
